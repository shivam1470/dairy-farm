// This is your Prisma schema file
// Learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      UserRole @default(VIEWER)
  farmId    String?
  farm      Farm?    @relation(fields: [farmId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  createdExpenses   Expense[]     @relation("ExpenseCreator")
  createdTasks      Task[]        @relation("TaskCreator")
  createdDeliveries DeliveryLog[] @relation("DeliveryCreator")
  assignedTasks     Task[]        @relation("TaskAssignee")
  recordedFeeding   FeedingLog[]  @relation("FeedingRecorder")
  assignedMilestones DevelopmentMilestone[] @relation("MilestoneAssignee")
  createdPayments   Payment[]     @relation("PaymentCreator")

  @@map("users")
}

enum UserRole {
  ADMIN
  MANAGER
  WORKER
  VIEWER
}

model Farm {
  id                     String   @id @default(cuid())
  name                   String
  location               String
  totalArea              Float?
  ownerName              String
  contactNumber          String
  developmentStatus      FarmDevelopmentStatus @default(PLANNING)
  estimatedCompletionDate DateTime?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  // Relations
  users             User[]
  animals           Animal[]
  expenses          Expense[]
  workers           Worker[]
  tasks             Task[]
  deliveries        DeliveryLog[]
  developmentPhases FarmDevelopmentPhase[]
  payments          Payment[]
  wallet            Wallet?

  @@map("farms")
}

model Animal {
  id                String           @id @default(cuid())
  tagNumber         String           @unique
  name              String?
  breed             String
  dateOfBirth       DateTime
  timeOfBirth       DateTime?
  gender            AnimalGender
  type              AnimalType
  lifeStage         LifeStage
  status            AnimalStatus     @default(ACTIVE)
  acquisitionType   AnimalAcquisitionType @default(BORN)
  farmId            String
  farm              Farm             @relation(fields: [farmId], references: [id])
  purchaseDate      DateTime?
  purchasePrice     Float?
  purchaseFromName  String?
  purchaseFromMobile String?
  purchaseFromEmail String?
  currentWeight     Float?
  notes             String?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  // Relations
  milkRecords MilkRecord[]
  feedingLogs FeedingLog[]
  vetVisits   VetVisit[]

  @@map("animals")
}

enum AnimalGender {
  MALE
  FEMALE
}

enum AnimalType {
  COW
  BUFFALO
}

enum LifeStage {
  CALF
  HEIFER
  ADULT
}

enum AnimalStatus {
  ACTIVE
  PREGNANT
  SICK
  SOLD
  DECEASED
}

enum AnimalAcquisitionType {
  BORN
  PURCHASED
}

model MilkRecord {
  id         String       @id @default(cuid())
  animalId   String
  animal     Animal       @relation(fields: [animalId], references: [id])
  farmId     String
  date       DateTime
  session    MilkSession
  quantity   Float
  fatContent Float?
  quality    MilkQuality?
  notes      String?
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  @@map("milk_records")
}

enum MilkSession {
  MORNING
  EVENING
}

enum MilkQuality {
  EXCELLENT
  GOOD
  AVERAGE
  POOR
}

model Expense {
  id            String          @id @default(cuid())
  farmId        String
  farm          Farm            @relation(fields: [farmId], references: [id])
  category      ExpenseCategory
  description   String
  amount        Float
  date          DateTime
  paymentMethod PaymentMethod   @default(CASH)
  receiptNumber String?
  vendor        String?
  notes         String?
  createdById   String
  creator       User            @relation("ExpenseCreator", fields: [createdById], references: [id])
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  @@map("expenses")
}

enum ExpenseCategory {
  FEED
  MEDICINE
  EQUIPMENT
  LABOR
  UTILITIES
  MAINTENANCE
  VETERINARY
  TRANSPORT
  OTHER
}

enum PaymentMethod {
  CASH
  CARD
  UPI
  BANK_TRANSFER
  CHEQUE
}

model Worker {
  id            String       @id @default(cuid())
  farmId        String
  farm          Farm         @relation(fields: [farmId], references: [id])
  name          String
  contactNumber String
  email         String?
  address       String?
  role          WorkerRole
  shift         WorkerShift  @default(DAY)
  salary        Float
  joinDate      DateTime
  status        WorkerStatus @default(ACTIVE)
  notes         String?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  @@map("workers")
}

enum WorkerRole {
  MANAGER
  SUPERVISOR
  MILKER
  FEEDER
  CLEANER
  DRIVER
  VETERINARIAN
  OTHER
}

enum WorkerShift {
  MORNING
  EVENING
  NIGHT
  DAY
  FULL_TIME
}

enum WorkerStatus {
  ACTIVE
  ON_LEAVE
  RESIGNED
  TERMINATED
}

model Task {
  id           String       @id @default(cuid())
  farmId       String
  farm         Farm         @relation(fields: [farmId], references: [id])
  title        String
  description  String?
  assignedToId String?
  assignedTo   User?        @relation("TaskAssignee", fields: [assignedToId], references: [id])
  dueDate      DateTime
  priority     TaskPriority
  status       TaskStatus   @default(PENDING)
  notes        String?
  createdById  String
  creator      User         @relation("TaskCreator", fields: [createdById], references: [id])
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  @@map("tasks")
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model FeedingLog {
  id           String      @id @default(cuid())
  farmId       String
  animalId     String
  animal       Animal      @relation(fields: [animalId], references: [id])
  date         DateTime
  feedingTime  FeedingTime
  feedType     FeedType
  quantity     Float
  cost         Float?
  notes        String?
  recordedById String
  recorder     User        @relation("FeedingRecorder", fields: [recordedById], references: [id])
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  @@map("feeding_logs")
}

enum FeedingTime {
  MORNING
  AFTERNOON
  EVENING
}

enum FeedType {
  HAY
  SILAGE
  CONCENTRATE
  GRAINS
  MINERAL_SUPPLEMENTS
  FRESH_GRASS
}

model DeliveryLog {
  id             String         @id @default(cuid())
  farmId         String
  farm           Farm           @relation(fields: [farmId], references: [id])
  deliveryDate   DateTime
  buyerName      String
  buyerPhone     String?
  quantity       Float
  pricePerLiter  Float
  totalAmount    Float
  deliveryStatus DeliveryStatus @default(PENDING)
  paymentStatus  PaymentStatus  @default(PENDING)
  address        String?
  notes          String?
  createdById    String
  creator        User           @relation("DeliveryCreator", fields: [createdById], references: [id])
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  @@map("delivery_logs")
}

enum DeliveryStatus {
  PENDING
  DELIVERED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  PARTIAL
  OVERDUE
}

model VetVisit {
  id            String         @id @default(cuid())
  animalId      String
  animal        Animal         @relation(fields: [animalId], references: [id])
  visitDate     DateTime
  visitType     VetVisitType?
  visitReason   String
  treatmentType TreatmentType?
  diagnosis     String?
  treatment     String?
  prescription  String?
  veterinarian  String
  cost          Float
  visitStatus   VetVisitStatus @default(SCHEDULED)
  nextVisitDate DateTime?
  notes         String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@map("vet_visits")
}

enum VetVisitType {
  ROUTINE
  EMERGENCY
  FOLLOWUP
  VACCINATION
  CHECKUP
}

enum TreatmentType {
  VACCINATION
  MEDICATION
  SURGERY
  CHECKUP
  DEWORMING
  OTHER
}

enum VetVisitStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
}

model FarmDevelopmentPhase {
  id            String   @id @default(cuid())
  farmId        String
  farm          Farm     @relation(fields: [farmId], references: [id], onDelete: Cascade)
  
  phaseName     String
  description   String?
  phaseOrder    Int      @default(0)
  status        DevelopmentStatus @default(NOT_STARTED)
  progress      Int      @default(0)
  
  budget        Float?
  actualCost    Float?
  
  startDate     DateTime?
  targetDate    DateTime?
  completedDate DateTime?
  
  notes         String?
  
  milestones    DevelopmentMilestone[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([farmId])
  @@map("farm_development_phases")
}

model DevelopmentMilestone {
  id            String   @id @default(cuid())
  phaseId       String
  phase         FarmDevelopmentPhase @relation(fields: [phaseId], references: [id], onDelete: Cascade)
  
  title         String
  description   String?
  milestoneOrder Int    @default(0)
  status        MilestoneStatus @default(PENDING)
  
  dueDate       DateTime?
  completedDate DateTime?
  
  assignedToId  String?
  assignedTo    User?   @relation("MilestoneAssignee", fields: [assignedToId], references: [id])
  
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([phaseId])
  @@map("development_milestones")
}

enum FarmDevelopmentStatus {
  PLANNING
  LAND_ACQUISITION
  INFRASTRUCTURE
  EQUIPMENT_SETUP
  ANIMAL_ACQUISITION
  OPERATIONAL
}

enum DevelopmentStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  ON_HOLD
  CANCELLED
}

enum MilestoneStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  BLOCKED
}

model Payment {
  id            String         @id @default(cuid())
  farmId        String
  farm          Farm           @relation(fields: [farmId], references: [id])
  type          PaymentType
  category      PaymentCategory
  amount        Float
  description   String
  date          DateTime
  paymentMethod PaymentMethod  @default(CASH)
  referenceId   String?        // Reference to related entity (expense, delivery, etc.)
  referenceType ReferenceType? // Type of referenced entity
  notes         String?
  createdById   String
  creator       User           @relation("PaymentCreator", fields: [createdById], references: [id])
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@index([farmId])
  @@index([date])
  @@map("payments")
}

enum PaymentType {
  INCOME
  EXPENSE
}

enum PaymentCategory {
  MILK_SALES
  ANIMAL_SALES
  FEED
  MEDICINE
  EQUIPMENT
  LABOR
  UTILITIES
  MAINTENANCE
  VETERINARY
  TRANSPORT
  INVESTMENT
  OTHER_INCOME
  OTHER_EXPENSE
}

enum ReferenceType {
  EXPENSE
  DELIVERY
  VET_VISIT
  FEEDING_LOG
  OTHER
}

model Wallet {
  id             String   @id @default(cuid())
  farmId         String   @unique
  farm           Farm     @relation(fields: [farmId], references: [id])
  currentBalance Float    @default(0)
  lastUpdated    DateTime @default(now())
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("wallets")
}
